{% extends "_layouts/cp" %}
{% import '_includes/forms' as forms %}

{% includeCssResource "css/entry.css" %}
{% includeCssResource "seomatic/css/style.css" %}
{% includeCssResource "seomatic/css/css-reset.css" %}
{% includeCssResource "seomatic/css/prism.min.css" %}
{% includeJsResource "seomatic/js/seomatic.js" %}
{% includeJsResource "seomatic/js/jquery.bpopup.min.js" %}
{% includeJsResource "seomatic/js/prism.min.js" %}

{% set title = "SEOmatic"|t %}

{% set docsUrl = "https://github.com/khalwat/seomatic/blob/master/README.md" %}

{% set fullPageForm = true %}
{% set hasCustomLayout = true %}

{% set tabs = {
	meta:		{ label: "SEO Template Meta"|t, url: url('seomatic/meta') },
	site:		{ label: "SEO Site Meta"|t, url: url('seomatic/site') },
	identity:	{ label: "Site Identity"|t, url: url('seomatic/identity') },
	social:		{ label: "Social Media"|t, url: url('seomatic/social') },
	creator:	{ label: "Site Creator"|t, url: url('seomatic/creator') },
} %}

{% set selectedTab = 'site' %}

{% block main %}

	{% include "seomatic/_preview_display_modal" with {'previewMetaPath': '', 'locale': siteMeta.locale } %}
	{% include "seomatic/_preview_tags_modal" with {'previewMetaPath': '', 'locale': siteMeta.locale } %}

<!-- Needed for for Craft < 2.5 -->

	{% if craft.app.version < 2.5 %}
	<form id="site-form" method="post" accept-charset="UTF-8" data-saveshortcut="1" data-saveshortcut-redirect="{{ continueEditingUrl }}">
	{% endif %}

	    <input type="hidden" name="action" value="seomatic/saveSiteMeta" />
	    <input type="hidden" name="redirect" value="seomatic/site{% if craft.isLocalized %}/{{ siteMeta.locale }}{% endif %}" />
	    {{ getCsrfInput() }}
		<input type="hidden" name="locale" value="{{ siteMeta.locale }}">

		<div class="grid first">
			<div class="item" data-position="left" data-min-colspan="2" data-max-colspan="3">
				<div id="fields" class="pane">
					{% include "_includes/tabs" %}
					
					{{ forms.textField({
						label: "Site SEO Name"|t,
						instructions: "This field is used wherever the name of the site is referenced, both at the trailing end of the <code>&lt;title&gt;</code> tag, and in other meta tags on the site.  It is initially set to your Craft <code>{{ siteName }}</code>." |t |raw,
						id: "siteSeoName",
						class: 'nicetext',
						name: "siteSeoName",
						value: siteMeta.siteSeoName,
						required: true,
						locale: siteMeta.locale,
					}) }}
					
					{{ forms.textField({
						label: "Site SEO Title"|t,
						instructions: "This should be between 10 and 70 characters (spaces included).  Make sure your title tag is explicit and contains your most important keywords. Be sure that each page has a unique title tag." |t |raw,
						id: 'siteSeoTitle',
						class: 'nicetext',
						name: 'siteSeoTitle',
						value: siteMeta.siteSeoTitle,
						maxlength: 70,
						showCharsLeft: true,
						required: false,
						locale: siteMeta.locale,
					}) }}
					
					<div class="field" id="siteSeoDescription-field">
						<div class="heading">
							<label for="siteSeoDescription">{{ "Site SEO Description"|t}}{% if craft.isLocalized and siteMeta.locale %}<span class="locale">{{ siteMeta.locale }}</span>{% endif %}</label>
							<div class="instructions"><p>{{ "This should be between 70 and 160 characters (spaces included).  Meta descriptions allow you to influence how your web pages are described and displayed in search results.  Ensure that all of your web pages have a unique meta description that is explicit and contains your most important keywords." |t |raw}}</p></div>
						</div>
					{{ forms.textarea({
						label: "siteSeoDescription"|t,
						instructions: "siteSeoDescription_help" |t |raw,
						id: 'siteSeoDescription',
						class: 'nicetext',
						name: 'siteSeoDescription',
						value: siteMeta.siteSeoDescription,
						maxlength: 160,
						showCharsLeft: true,
						required: false,
						locale: siteMeta.locale,
					}) }}
					</div>
					
					<div class="field" id="siteSeoKeywords-field">
						<div class="heading">
							<label for="siteSeoDescription">{{ "Site SEO Keywords"|t}}{% if craft.isLocalized and siteMeta.locale %}<span class="locale">{{ siteMeta.locale }}</span>{% endif %}</label>
							<div class="instructions"><p>{{ "Google ignores this tag; though other search engines do look at it.  Utilize it carefully, as improper or spammy use most likely will hurt you, or even have your site marked as spam.  Avoid overstuffing the keywords and do not include keywords that are not related to the specific page you place them on." |t |raw}}</p></div>
						</div>
					{{ forms.textarea({
						label: "siteSeoKeywords"|t,
						instructions: "siteSeoKeywords_help" |t |raw,
						id: 'siteSeoKeywords',
						class: 'nicetext',
						name: 'siteSeoKeywords',
						value: siteMeta.siteSeoKeywords,
						maxlength: 200,
						showCharsLeft: true,
						required: false,
						locale: siteMeta.locale,
					}) }}
					</div>
					
					<div class="field" id="siteSeoImageId-field">
						<div class="heading">
							<label for="siteSeoImageId">{{ "Site SEO Image"|t}}{% if craft.isLocalized and siteMeta.locale %}<span class="locale">{{ siteMeta.locale }}</span>{% endif %}</label>
							<div class="instructions"><p>{{ "This is the image that will be used for display as the global website brand, as well as on Twitter Cards and Facebook OpenGraph that link to the website.  It should be an image that displays well when cropped to a square format (for Twitter)" |t |raw}}</p></div>
						</div>
						<div class="input">
							{% if assetsSourceExists %}
								{{ forms.elementSelect({
									elements: elements,
									id: 'siteSeoImageId',
									name: 'siteSeoImageId',
									elementType: elementType,
									criteria: {
										'kind': [],
										'localeEnabled': null,
										'locale': craft.locale,
									},
									sourceElementId: siteSeoImageId,
									jsClass: 'Craft.AssetSelectInput',
									addButtonLabel: "Select SEO Image" |t,
									limit: 1,
									locale: siteMeta.locale,
								}) }}
							{% else %}
								<p class="error">No assets sources currently exist. <a href="{{ newAssetsSourceUrl }}">Create one now...</a></p>
							{% endif %}
						</div>
					</div>
        
					<p>&nbsp;</p>
 					<p>{{ "<p>You can use any Craft <code>environmentVariables</code> in these fields in addition to static text, e.g.:<br /> <code>This is my {baseUrl}</code></p>" |t |raw }}</p>
  
				</div>
									
			</div>

			<div class="item" data-position="right" data-colspan="1">

				<div id="preview-display" class="btn big livepreviewbtn">
					{{ "Preview SEO Meta Display" |t }}
				</div>

				<div id="preview-tags" class="btn big livepreviewbtn secondbtn">
					{{ "Preview SEO Meta Tags" |t }}
				</div>
				
				{% if craft.isLocalized %}
					<ul id="locales" class="pane">
						{% for locale in craft.i18n.getSiteLocales() %}
							{% if locale == siteMeta.locale %}
								<li class="sel">{{ locale.name }}</li>
							{% else %}
								<li><a href="{{ url('seomatic/site') ~ '/' ~ locale.id }}">{{ locale.name }}</a></li>
							{% endif %}
						{% endfor %}
						<li><p class="instructions">{{ "If any field is left blank for a setting in a particular locale, it will fall back on the primary locale." |t |raw }}</p></li>
					</ul>
				{% endif %}
				
				<div class="pane">
					<div style="text-align:center; margin:0 auto;">
						<img src="{{ resourceUrl('seomatic/images/seo_site.svg') }}" width="64px" height="auto" />
					</div>
					{{ "<p>These SEO Site Meta settings are used to globally define the Meta for the website.  When no SEO Template Meta is found for a webpage, these settings are used by default.</p><p>They are used in combination with the SEO Template Meta settings to generate <a href='https://developers.google.com/schemas/formats/json-ld?hl=en' target='_blank'>JSON-LD</a> microdata, <a href='http://dublincore.org' target='_blank'>Dublin Core</a> core metadata, <a href='https://dev.twitter.com/cards/overview' target='_blank'>Twitter Cards</a>, <a href='https://developers.facebook.com/docs/sharing/opengraph' target='_blank'>Facebook OpenGraph</a>, and as well as HTML meta tags.<p>If a no Template Meta exists for a template, the SEO Site Meta is used.</p>  <p>If any fields are left blank in a Template Meta, those fields are pulled from the SEO Site Meta.</p><p>You can also dynamically change any of these SEO Meta fields in your Twig templates, and they will appear in the rendered SEO Meta.</p>" |t |raw }}
				</div>

			</div>

<!-- Needed for for Craft < 2.5 -->

			{% if craft.app.version < 2.5 %}
			<div class="item" data-position="left" data-colspan="1">
				<div class="buttons">
					<div class="btngroup submit first">
						<input type="submit" class="btn submit" value="{{ 'Save'|t }}">
					</div>
				</div>
			</div>
			{% endif %}

		</div>

<!-- Needed for for Craft < 2.5 -->

	{% if craft.app.version < 2.5 %}
	</form>
	{% endif %}

{% endblock %}
